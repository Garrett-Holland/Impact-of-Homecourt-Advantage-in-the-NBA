---
title: "Impact of Homecourt Advantage on the NBA"
output: html_notebook
---

```{r}
library(tidyverse)
library(sf)
library(leaflet)
library(dplyr)
library(htmltools)
library(scales)
library(units)
```

```{r}
data <- read.csv(file = "../data/games.csv")
```

```{r}
data <- data %>% 
  rename('Winner' = 'HOME_TEAM_WINS')
```

```{r}
data$TEAM_ID_home[data$TEAM_ID_home=='1610612740']<- 'New Orleans Pelicans'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612762']<- 'Utah Jazz'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612739']<- 'Cleveland Cavaliers'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612755']<- 'Philadelphia 76ers'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612737']<- 'Atlanta Hawks'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612738']<- 'Boston Celtics'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612751']<- 'Brooklyn Nets'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612752']<- 'New York Knicks'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612745']<- 'Houston Rockets'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612750']<- 'Minnesota Timberwolves'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612760']<- 'Oklahoma City Thunder'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612758']<- 'Sacramento Kings'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612746']<- 'Los Angeles Clippers'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612765']<- 'Detroit Pistons'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612748']<- 'Miami Heat'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612756']<- 'Phoenix Suns'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612743']<- 'Denver Nuggets'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612754']<- 'Indiana Pacers'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612761']<- 'Toronto Raptors'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612747']<- 'Los Angeles Lakers'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612759']<- 'San Antonio Spurs'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612749']<- 'Milwaukee Bucks'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612766']<- 'Charlotte Hornets'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612741']<- 'Chicago Bulls'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612742']<- 'Dallas Mavericks'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612763']<- 'Memphis Grizzlies'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612753']<- 'Orlando Magic'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612744']<- 'Golden State Warriors'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612764']<- 'Washington Wizards'
data$TEAM_ID_home[data$TEAM_ID_home=='1610612757']<- 'Portland Trailblazers'
```

```{r}
data$TEAM_ID_away[data$TEAM_ID_away=='1610612740']<- 'New Orleans Pelicans'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612762']<- 'Utah Jazz'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612739']<- 'Cleveland Cavaliers'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612755']<- 'Philadelphia 76ers'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612737']<- 'Atlanta Hawks'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612738']<- 'Boston Celtics'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612751']<- 'Brooklyn Nets'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612752']<- 'New York Knicks'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612745']<- 'Houston Rockets'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612750']<- 'Minnesota Timberwolves'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612760']<- 'Oklahoma City Thunder'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612758']<- 'Sacramento Kings'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612746']<- 'Los Angeles Clippers'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612765']<- 'Detroit Pistons'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612748']<- 'Miami Heat'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612756']<- 'Phoenix Suns'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612743']<- 'Denver Nuggets'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612754']<- 'Indiana Pacers'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612761']<- 'Toronto Raptors'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612747']<- 'Los Angeles Lakers'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612759']<- 'San Antonio Spurs'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612749']<- 'Milwaukee Bucks'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612766']<- 'Charlotte Hornets'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612741']<- 'Chicago Bulls'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612742']<- 'Dallas Mavericks'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612763']<- 'Memphis Grizzlies'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612753']<- 'Orlando Magic'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612744']<- 'Golden State Warriors'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612764']<- 'Washington Wizards'
data$TEAM_ID_away[data$TEAM_ID_away=='1610612757']<- 'Portland Trailblazers'
```


```{r}
data$Winner[data$Winner=='0']<- 'Away'
data$Winner[data$Winner=='1']<- 'Home'
```

```{r}
mean(data$PTS_home, na.rm = TRUE)
mean(data$PTS_away, na.rm = TRUE)
```
```{r}
mean(data$FG_PCT_home, na.rm = TRUE)
mean(data$FG_PCT_away, na.rm = TRUE)
```


```{r}
mean(data$FG3_PCT_home, na.rm = TRUE)
mean(data$FG3_PCT_away, na.rm = TRUE)
```

```{r}
mean(data$FT_PCT_home, na.rm = TRUE)
mean(data$FT_PCT_away, na.rm = TRUE)
```

```{r}
mean(data$AST_home, na.rm = TRUE)
mean(data$AST_away, na.rm = TRUE)
```

```{r}
mean(data$REB_home, na.rm = TRUE)
mean(data$REB_away, na.rm = TRUE)
```
```{r}
data %>%
  group_by(Winner) %>%
  summarise(frequency = n()) %>%
  mutate(relative_frequency = frequency / sum(frequency)) 
```

```{r}
data_winners <- filter(data, Winner == 'Home')
```

```{r}
data_losers <- filter(data, Winner == 'Away')
```

```{r}
home_win <- data_winners %>% 
  count(TEAM_ID_home, Winner) %>% 
  rename(frequency = n)
```

```{r}
home_loss <- data_losers %>% 
  count(TEAM_ID_home, Winner) %>% 
  rename(frequency = n)
```

```{r}
home_win_loss <- merge(home_win, home_loss, by = 'TEAM_ID_home')
```

```{r}
home_win_loss <- home_win_loss %>% 
  rename(Win = frequency.x, Loss = frequency.y, Home = Winner.x, Away = Winner.y, Team = TEAM_ID_home)
```

```{r}
home_win_loss <- home_win_loss %>%
  group_by(Team) %>% 
  mutate(Total = sum(Win, Loss))
```

```{r}
home_win_loss <- home_win_loss %>%
  group_by(Team) %>% 
  mutate(Win_Percentage = Win / Total)
```

```{r}
away_win <- data_losers %>% 
  count(TEAM_ID_away, Winner) %>% 
  rename(frequency = n)
```

```{r}
away_loss <- data_winners %>% 
  count(TEAM_ID_away, Winner) %>% 
  rename(frequency = n)
```

```{r}
away_win_loss <- merge(away_win, away_loss, by = 'TEAM_ID_away')
```

```{r}
away_win_loss <- away_win_loss %>% 
  rename(Win = frequency.x, Loss = frequency.y, Away = Winner.x, Home = Winner.y, Team = TEAM_ID_away)
```

```{r}
away_win_loss <- away_win_loss %>%
  group_by(Team) %>% 
  mutate(Total = sum(Win, Loss))
```

```{r}
away_win_loss <- away_win_loss %>%
  group_by(Team) %>% 
  mutate(Win_Percentage = Win / Total)
```

```{r}
Teams <- merge(home_win_loss, away_win_loss, by = 'Team')
```

```{r}
Teams <- Teams %>% 
  rename(Home_Win = Win.x, Home_Loss = Loss.x, Home_Total = Total.x, Home_Win_Percentage = Win_Percentage.x, Away_Win = Win.y, Away_Loss = Loss.y, Away_Total = Total.y, Away_Win_Percentage = Win_Percentage.y)
```

```{r}
Teams <- subset(Teams, select = c(Team, Home_Win, Home_Loss, Home_Total, Home_Win_Percentage, Away_Win, Away_Loss, Away_Total, Away_Win_Percentage))
```

```{r}
Teams <- Teams %>%
  group_by(Team) %>% 
  mutate(Win_Pct_Differential = Home_Win_Percentage - Away_Win_Percentage)
```

```{r}
ggplot(Teams, aes(x = Win_Pct_Differential, y = reorder(Team, Win_Pct_Differential), color = Team)) +
  geom_point() +
  geom_smooth(method=lm) +
  theme(legend.position = 'none') +
  labs(title = "Home Court Impact", x = "Win % Differential Home vs Away", y = "Teams")
```

```{r}
ggplot(Teams, aes(x=Win_Pct_Differential, y=reorder(Team, Win_Pct_Differential), fill=Team)) +
  geom_bar(stat="identity") +
  theme(legend.position = 'none') +
  labs(title = "Home Court Impact", x = "Win % Differential Home vs Away", y = "Teams")
```

```{r}
data <- data %>% 
  group_by(TEAM_ID_home) %>% 
  mutate(Pts_Scored_Home = mean(PTS_home, na.rm = TRUE))
```

```{r}
data <- data %>% 
  group_by(TEAM_ID_home) %>% 
  mutate(Pts_Against_Home = mean(PTS_away, na.rm = TRUE))
```

```{r}
data <- data %>% 
  group_by(TEAM_ID_away) %>% 
  mutate(Pts_Scored_Away = mean(PTS_away, na.rm = TRUE))
```

```{r}
data <- data %>% 
  group_by(TEAM_ID_away) %>% 
  mutate(Pts_Against_Away = mean(PTS_home, na.rm = TRUE))
```

```{r}
data <- data %>% 
  group_by(TEAM_ID_home) %>% 
  mutate(Pts_Home_Differential = Pts_Scored_Home - Pts_Against_Home)
```

```{r}
data <- data %>% 
  group_by(TEAM_ID_away) %>% 
  mutate(Pts_Away_Differential = Pts_Scored_Away - Pts_Against_Away)
```